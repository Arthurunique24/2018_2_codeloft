!function(e){var t=window.webpackHotUpdate;window.webpackHotUpdate=function(e,n){!function(e,t){if(!_[e]||!w[e])return;for(var n in w[e]=!1,t)Object.prototype.hasOwnProperty.call(t,n)&&(m[n]=t[n]);0==--f&&0===y&&x()}(e,n),t&&t(e,n)};var n,s=!0,r="9b3080cbddb83f028be6",i=1e4,a={},o=[],l=[];function c(e){var t=P[e];if(!t)return k;var s=function(s){return t.hot.active?(P[s]?-1===P[s].parents.indexOf(e)&&P[s].parents.push(e):(o=[e],n=s),-1===t.children.indexOf(s)&&t.children.push(s)):(console.warn("[HMR] unexpected require("+s+") from disposed module "+e),o=[]),k(s)},r=function(e){return{configurable:!0,enumerable:!0,get:function(){return k[e]},set:function(t){k[e]=t}}};for(var i in k)Object.prototype.hasOwnProperty.call(k,i)&&"e"!==i&&"t"!==i&&Object.defineProperty(s,i,r(i));return s.e=function(e){return"ready"===h&&u("prepare"),y++,k.e(e).then(t,function(e){throw t(),e});function t(){y--,"prepare"===h&&(b[e]||A(e),0===y&&0===f&&x())}},s.t=function(e,t){return 1&t&&(e=s(e)),k.t(e,-2&t)},s}var d=[],h="idle";function u(e){h=e;for(var t=0;t<d.length;t++)d[t].call(null,e)}var p,m,g,f=0,y=0,b={},w={},_={};function v(e){return+e+""===e?+e:e}function E(e){if("idle"!==h)throw new Error("check() is only allowed in idle status");return s=e,u("check"),function(e){return e=e||1e4,new Promise(function(t,n){if("undefined"==typeof XMLHttpRequest)return n(new Error("No browser support"));try{var s=new XMLHttpRequest,i=k.p+""+r+".hot-update.json";s.open("GET",i,!0),s.timeout=e,s.send(null)}catch(e){return n(e)}s.onreadystatechange=function(){if(4===s.readyState)if(0===s.status)n(new Error("Manifest request to "+i+" timed out."));else if(404===s.status)t();else if(200!==s.status&&304!==s.status)n(new Error("Manifest request to "+i+" failed."));else{try{var e=JSON.parse(s.responseText)}catch(e){return void n(e)}t(e)}}})}(i).then(function(e){if(!e)return u("idle"),null;w={},b={},_=e.c,g=e.h,u("prepare");var t=new Promise(function(e,t){p={resolve:e,reject:t}});m={};return A(0),"prepare"===h&&0===y&&0===f&&x(),t})}function A(e){_[e]?(w[e]=!0,f++,function(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("script");n.charset="utf-8",n.src=k.p+""+e+"."+r+".hot-update.js",t.appendChild(n)}(e)):b[e]=!0}function x(){u("ready");var e=p;if(p=null,e)if(s)Promise.resolve().then(function(){return I(s)}).then(function(t){e.resolve(t)},function(t){e.reject(t)});else{var t=[];for(var n in m)Object.prototype.hasOwnProperty.call(m,n)&&t.push(v(n));e.resolve(t)}}function I(t){if("ready"!==h)throw new Error("apply() is only allowed in ready status");var n,s,i,l,c;function d(e){for(var t=[e],n={},s=t.slice().map(function(e){return{chain:[e],id:e}});s.length>0;){var r=s.pop(),i=r.id,a=r.chain;if((l=P[i])&&!l.hot._selfAccepted){if(l.hot._selfDeclined)return{type:"self-declined",chain:a,moduleId:i};if(l.hot._main)return{type:"unaccepted",chain:a,moduleId:i};for(var o=0;o<l.parents.length;o++){var c=l.parents[o],d=P[c];if(d){if(d.hot._declinedDependencies[i])return{type:"declined",chain:a.concat([c]),moduleId:i,parentId:c};-1===t.indexOf(c)&&(d.hot._acceptedDependencies[i]?(n[c]||(n[c]=[]),p(n[c],[i])):(delete n[c],t.push(c),s.push({chain:a.concat([c]),id:c})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:n}}function p(e,t){for(var n=0;n<t.length;n++){var s=t[n];-1===e.indexOf(s)&&e.push(s)}}t=t||{};var f={},y=[],b={},w=function(){console.warn("[HMR] unexpected require("+A.moduleId+") to disposed module")};for(var E in m)if(Object.prototype.hasOwnProperty.call(m,E)){var A;c=v(E);var x=!1,I=!1,M=!1,L="";switch((A=m[E]?d(c):{type:"disposed",moduleId:E}).chain&&(L="\nUpdate propagation: "+A.chain.join(" -> ")),A.type){case"self-declined":t.onDeclined&&t.onDeclined(A),t.ignoreDeclined||(x=new Error("Aborted because of self decline: "+A.moduleId+L));break;case"declined":t.onDeclined&&t.onDeclined(A),t.ignoreDeclined||(x=new Error("Aborted because of declined dependency: "+A.moduleId+" in "+A.parentId+L));break;case"unaccepted":t.onUnaccepted&&t.onUnaccepted(A),t.ignoreUnaccepted||(x=new Error("Aborted because "+c+" is not accepted"+L));break;case"accepted":t.onAccepted&&t.onAccepted(A),I=!0;break;case"disposed":t.onDisposed&&t.onDisposed(A),M=!0;break;default:throw new Error("Unexception type "+A.type)}if(x)return u("abort"),Promise.reject(x);if(I)for(c in b[c]=m[c],p(y,A.outdatedModules),A.outdatedDependencies)Object.prototype.hasOwnProperty.call(A.outdatedDependencies,c)&&(f[c]||(f[c]=[]),p(f[c],A.outdatedDependencies[c]));M&&(p(y,[A.moduleId]),b[c]=w)}var O,S=[];for(s=0;s<y.length;s++)c=y[s],P[c]&&P[c].hot._selfAccepted&&S.push({module:c,errorHandler:P[c].hot._selfAccepted});u("dispose"),Object.keys(_).forEach(function(e){!1===_[e]&&function(e){delete installedChunks[e]}(e)});for(var H,T,R=y.slice();R.length>0;)if(c=R.pop(),l=P[c]){var C={},j=l.hot._disposeHandlers;for(i=0;i<j.length;i++)(n=j[i])(C);for(a[c]=C,l.hot.active=!1,delete P[c],delete f[c],i=0;i<l.children.length;i++){var B=P[l.children[i]];B&&((O=B.parents.indexOf(c))>=0&&B.parents.splice(O,1))}}for(c in f)if(Object.prototype.hasOwnProperty.call(f,c)&&(l=P[c]))for(T=f[c],i=0;i<T.length;i++)H=T[i],(O=l.children.indexOf(H))>=0&&l.children.splice(O,1);for(c in u("apply"),r=g,b)Object.prototype.hasOwnProperty.call(b,c)&&(e[c]=b[c]);var U=null;for(c in f)if(Object.prototype.hasOwnProperty.call(f,c)&&(l=P[c])){T=f[c];var D=[];for(s=0;s<T.length;s++)if(H=T[s],n=l.hot._acceptedDependencies[H]){if(-1!==D.indexOf(n))continue;D.push(n)}for(s=0;s<D.length;s++){n=D[s];try{n(T)}catch(e){t.onErrored&&t.onErrored({type:"accept-errored",moduleId:c,dependencyId:T[s],error:e}),t.ignoreErrored||U||(U=e)}}}for(s=0;s<S.length;s++){var N=S[s];c=N.module,o=[c];try{k(c)}catch(e){if("function"==typeof N.errorHandler)try{N.errorHandler(e)}catch(n){t.onErrored&&t.onErrored({type:"self-accept-error-handler-errored",moduleId:c,error:n,originalError:e}),t.ignoreErrored||U||(U=n),U||(U=e)}else t.onErrored&&t.onErrored({type:"self-accept-errored",moduleId:c,error:e}),t.ignoreErrored||U||(U=e)}}return U?(u("fail"),Promise.reject(U)):(u("idle"),new Promise(function(e){e(y)}))}var P={};function k(t){if(P[t])return P[t].exports;var s=P[t]={i:t,l:!1,exports:{},hot:function(e){var t={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:n!==e,active:!0,accept:function(e,n){if(void 0===e)t._selfAccepted=!0;else if("function"==typeof e)t._selfAccepted=e;else if("object"==typeof e)for(var s=0;s<e.length;s++)t._acceptedDependencies[e[s]]=n||function(){};else t._acceptedDependencies[e]=n||function(){}},decline:function(e){if(void 0===e)t._selfDeclined=!0;else if("object"==typeof e)for(var n=0;n<e.length;n++)t._declinedDependencies[e[n]]=!0;else t._declinedDependencies[e]=!0},dispose:function(e){t._disposeHandlers.push(e)},addDisposeHandler:function(e){t._disposeHandlers.push(e)},removeDisposeHandler:function(e){var n=t._disposeHandlers.indexOf(e);n>=0&&t._disposeHandlers.splice(n,1)},check:E,apply:I,status:function(e){if(!e)return h;d.push(e)},addStatusHandler:function(e){d.push(e)},removeStatusHandler:function(e){var t=d.indexOf(e);t>=0&&d.splice(t,1)},data:a[e]};return n=void 0,t}(t),parents:(l=o,o=[],l),children:[]};return e[t].call(s.exports,s,s.exports,c(t)),s.l=!0,s.exports}k.m=e,k.c=P,k.d=function(e,t,n){k.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},k.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},k.t=function(e,t){if(1&t&&(e=k(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(k.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)k.d(n,s,function(t){return e[t]}.bind(null,s));return n},k.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return k.d(t,"a",t),t},k.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},k.p="",k.h=function(){return r},c(1)(k.s=1)}([function(e,t,n){"use strict";e.exports.Validator=class{constructor(e={},t={}){this.inputs=e,this.labels=t,this.checkConfig={loginMin:e=>/.{3}/.test(e),loginMax:e=>!/.{16}/.test(e),passwordMin:e=>/.{8}/.test(e),passwordMax:e=>!/.{21}/.test(e),email:e=>/^[-._a-z0-9]+@(?:[a-z0-9][-a-z0-9]+\.)+[a-z]{2,6}$/i.test(e),russian:e=>!/[а-яё]/i.test(e),passwordsEquality:e=>e===this.inputs.password.render().value},this.messages={loginMin:"Login must be at least 3 symbols long",loginMax:"Login must be at most 15 symbols long",passwordMin:"Password must be at least 8 symbols long",passwordMax:"Password must be at most 20 symbols long",email:"Wrong email format",russian:"Please use only latin characters",passwordsEquality:"Password doesn't match"}}checkInput(e){let t=!0;return this.inputs[e].check.split(/\s+/g).forEach(n=>{this.checkConfig[n](this.inputs[e].render().value)||(t=!1,this.labels[e].show(),this.labels[e].render().innerText=this.messages[n])}),t&&this.labels[e].hide(),t}isValid(){let e=!0;return Object.keys(this.inputs).forEach(t=>{e=e&&this.checkInput(t)}),e}}},function(e,t,n){"use strict";n.r(t);var s=new class{constructor(){this.listeners={}}on(e,t){this.listeners[e]=this.listeners[e]||[],this.listeners[e].push(t)}off(e,t){this.listeners[e]=this.listeners[e].filter(e=>e!==t)}emit(e,t){this.listeners[e]&&this.listeners[e].forEach(e=>{e(t)})}};var r={MENU:"/",SIGN_IN:"/login",SIGN_UP:"/register",PROFILE:"/profile",ABOUT:"/about",HIGH_SCORE:"/score",SINGLE_PLAYER:"/singleplayer"};var i=new class{constructor(){this.routesMap={},this.currentView=null,document.addEventListener("keydown",e=>{"Enter"===e.key?this.currentView.mainEvent():"Escape"===e.key&&this.go(r.MENU)})}start(){window.onpopstate=(e=>{this._onRoute(window.location.pathname)}),s.on("loggedIn",this.goMenu.bind(this)),s.on("loggedOut",this.goMenu.bind(this)),this._onRoute(window.location.pathname)}_onRoute(e){const t=this.routesMap[e];t&&(this.currentView&&this.currentView.hide(),this.currentView=t,this.currentView.show())}add(e,t){return this.routesMap[e]=t,this}go(e){window.history.pushState({url:e},"",e),this._onRoute(e)}goMenu(){this.go(r.MENU)}};const a="",o="https://backend.codeloft.ru";class l{static Get(e){return l.FSend(o+e,"GET")}static Post(e,t){return l.FSend(o+e,"POST",t)}static Delete(e,t){return l.FSend(o+e,"DELETE",t)}static FSend(e,t,n={}){const s=a+e,r={method:t,headers:{Host:"localhost"},mode:"cors",credentials:"include"};return"POST"===t&&(r.body=JSON.stringify(n),r.headers={"Content-Type":"application/json; charset=utf-8"}),fetch(s,r)}static GetHTML(e,t){let n=`?template=${e}`;return Object.keys(t).forEach(e=>{n+=`&${e}=${t[e]}`}),fetch("https://codeloft.ru/template"+n,{method:"GET",headers:{Host:"localhost"},mode:"cors"})}}var c=new class{constructor(){this._clearUserData(),this.errorMessages={400:"Incorrect login or password"}}getUserInfo(e){return this.userInfo[e]}isLogIn(){return!!this.userInfo.login}checkAuth(){return l.Get("/session").then(e=>{if(200===e.status)return e.json();throw e.status}).then(e=>(this.userInfo=e,"ok")).catch(()=>this._clearUserData())}logOut(e,t){const n={login:e,password:t};return l.Delete("/session",n).then(()=>(this._clearUserData(),s.emit("loggedOut"),"ok"))}logIn(e){return this._handleAuthResponse(l.Post("/session",e))}register(e){return this._handleAuthResponse(l.Post("/user",e))}_handleAuthResponse(e){return e.then(e=>{if(200===e.status)return e.json();throw e.status}).then(e=>(this.userInfo=e,s.emit("loggedIn"),"ok")).catch(e=>e)}_clearUserData(){this.userInfo={login:null,email:null,score:null}}};const d="main-page__menu",h="main-page__menu__logo";class u{constructor(){this.element=null,this.elementsArray=[],this._needAuth=!1,this.logoText="Tron:remastered",this.mainLogo=document.getElementsByClassName(h)[0],s.on("enterPressed",this.mainEvent.bind(this)),s.on("loggedIn",this.handlePrivateComponents.bind(this)),s.on("loggedOut",this.handlePrivateComponents.bind(this))}init(){return new Promise(e=>{this.build().then(()=>{this.hide(),document.getElementsByClassName(d)[0].appendChild(this.render()),e()})})}mainEvent(){}build(){}render(){return this.element}preRender(){return new Promise(e=>e())}afterRender(){return new Promise(e=>e())}show(){this.preRender().then(()=>this.element?Promise.resolve():this.init()).then(()=>{!this.needAuth()||c.isLogIn()?this.afterRender().then(()=>{this.mainLogo.innerHTML=this.logoText,this.element.style.display="block"}):i.go(r.SIGN_IN)})}hide(){this.element&&(this.element.style.display="none")}handlePrivateComponents(){this.element&&this.elementsArray.forEach(e=>e.handleVisibility())}needAuth(){return this._needAuth}}const p=new class{constructor(){this.eventMap={}}handleEvent(e,t,n){e.addEventListener(t,this.eventMap[n])}addHandler(e,t){return this.eventMap[e]=t,this}};p.addHandler("goLogin",()=>{i.go(r.SIGN_IN)}).addHandler("goRegister",()=>{i.go(r.SIGN_UP)}).addHandler("goScore",()=>{i.go(r.HIGH_SCORE)}).addHandler("goAbout",()=>{i.go(r.ABOUT)}).addHandler("goProfile",()=>{i.go(r.PROFILE)}).addHandler("goMenu",()=>{i.go(r.MENU)}).addHandler("goSinglePlayer",()=>{i.go(r.SINGLE_PLAYER)}).addHandler("logOut",()=>{c.logOut()});var m=p;class g{constructor(){this.element=null,this.template=null,this.events=[],this._needAuth=!1,this._forAuth=!1}render(){return this.element}remove(){this.element.parentElement.removeChild(this.element)}compile(e){return"true"===e.needAuth?this._needAuth=!0:"true"===e.forAuth&&(this._forAuth=!0),l.GetHTML(this.template,e).then(e=>e.json()).then(t=>{const n=document.createElement("div");return n.innerHTML=t.html,this.element=n.lastChild,this.addEvents(e),this}).catch(e=>e)}preRender(){return new Promise(e=>e())}afterRender(e=new Promise(e=>e())){return e.then(()=>(this.handleVisibility(),this))}build(e){return this.preRender().then(()=>this.element?Promise.resolve():this.compile(e)).then(()=>this.afterRender())}handleVisibility(){this.needAuth()&&!c.isLogIn()?this.hide():this.forAuth()&&c.isLogIn()?this.hide():this.show()}hide(){this.element&&(this.element.style.display="none")}show(){this.element&&(this.element.style.display="block")}addEvents(e){this.events.forEach(t=>{m.handleEvent(this.element,t,e[t])})}needAuth(){return this._needAuth}forAuth(){return this._forAuth}}class f extends g{constructor(){super(),this.template='<div class = "{{class}}"><span>{{text}}</span></div>',this.events=["click"]}addEvents(e){this.events.forEach(t=>{m.handleEvent(this.element.children[0],t,e[t])})}}class y extends g{constructor(){super(),this.template='<input name="{{name}}" class="{{class}}" type="{{type}}" placeholder="{{placeholder}}">'}compile(e){return this.check=e.check,super.compile(e)}}class b extends g{preRender(){return this.template='<div class="leaderboard-page__users"></div>',super.preRender()}}class w extends g{constructor(){super(),this.template='<div>\n        <p class="profile-login"></p>\n        <p class="profile-email"></p>\n        <p class="profile-score"></p>\n        </div>'}afterRender(){return this.loginLabel=this.element.getElementsByClassName("profile-login")[0],this.emailLabel=this.element.getElementsByClassName("profile-email")[0],this.scoreLabel=this.element.getElementsByClassName("profile-score")[0],this.loginLabel.innerText=`User: ${c.getUserInfo("login")}`,this.emailLabel.innerText=`Email: ${c.getUserInfo("email")}`,super.afterRender()}}class _ extends g{constructor(){super(),this.template='<div name="{{name}}" class="{{class}}">{{text}}</div>'}}class v extends g{constructor(){super(),this.template='<p class="{{class}}" style="display: {{visible}}">{{text}}</p>'}}class E extends g{constructor(){super(),this.template='<canvas class="game-block" height="640" width="480" tabindex="0"></canvas>'}}class A extends g{constructor(){super(),this.template='<form class = "{{class}}"></form>',this.events=["click"]}addEvents(e){this.events.forEach(t=>{m.handleEvent(this.element.children,t,e[t])})}}class x extends g{constructor(){super(),this.template="<img src={{src}} class={{class}}>",this.events=["click"]}addEvents(e){this.events.forEach(t=>{m.handleEvent(this.element,t,e[t])})}}var I=new class{constructor(){this.tagExpr=/<\/?([^>\s\/]+)\s*([^>]*)\/?>/g,this.contextExpr=/{{([^=\s]+)\s*=\s*([^}]+)}}/g,this.tagMap={Button:()=>new f,Input:()=>new y,ScoreTable:()=>new b,UserInfo:()=>new w,Block:()=>new _,Label:()=>new v,GameBlock:()=>new E,Form:()=>new A,Img:()=>new x}}toHTML(e,t,n){return new Promise(t=>{let n;const s=[];for(;n=this.tagExpr.exec(e);){const e={};let t;for(e.fullText=n[0],e.tag=n[1];t=this.contextExpr.exec(n[2]);)e[t[1]]=t[2];s.push(this._getElement(e))}Promise.all(s).then(e=>{t(e)})})}_getElement(e){const t=this.tagMap[e.tag]();return new Promise(n=>{t.build(e).then(e=>n(e))})}};const P="In our game you will play for a motorcyclist, \n\t    which leaves a bright trace. Other players or bots will also\n\t     draw a line for themselves, and your task is to avoid contact with this line,\n\t      regardless of whether it's yours or not. Also, in order to win, you must draw a \n\t    line so that opponents can not avoid your trace. On the playing field will be spawned\n\t     various bonuses that will help you win. So do not yawn!";const k=n(0).Validator;const M=n(0).Validator;class L{constructor(e,t){this.element=document.createElement("a"),this.element.innerHTML=e,this.eventMap={"<<":()=>s.emit("getPage","-1"),">>":()=>s.emit("getPage","+1")},this.element.addEventListener("click",this.eventMap[e]||(()=>s.emit("getPage",e)))}render(){return this.element}hide(){this.reference.style.display="none"}show(){this.reference.style.display="block"}setActive(){this.element.setAttribute("class","active")}setUsual(){this.element.setAttribute("class","")}}c.checkAuth().then(()=>{i.add("/",new class extends u{build(){return new Promise(e=>{this.template="<Button {{class=main-page__button}} {{text=Single Player}} {{click=goSinglePlayer}} {{needAuth=true}}>\n                         <Button {{class=main-page__button}} {{text=Sign in}} {{click=goLogin}} {{forAuth=true}}>\n                         <Button {{class=main-page__button}} {{text=Sign up}} {{click=goRegister}} {{forAuth=true}}>\n                         <Button {{class=main-page__button}} {{text=Rules}} {{click=goAbout}}>\n                         <Button {{class=main-page__button}} {{text=High score}} {{click=goScore}}>\n                         <Button {{class=main-page__button}} {{text=Profile}} {{click=goProfile}} {{needAuth=true}}>",I.toHTML(this.template).then(t=>{this.elementsArray=t;const n=document.createElement("div");n.setAttribute("class","main-page__menu__buttons"),this.elementsArray.forEach(e=>{n.appendChild(e.render())}),this.element=n,e()})})}}).add(r.ABOUT,new class extends u{build(){return new Promise(e=>{this.template=`<Label {{class=about-page__rules}} {{text=${P}}}>\n                         <Button {{class=main-page__menu__button}} {{text=Back}} {{click=goMenu}}>`,I.toHTML(this.template).then(t=>{this.elementsArray=t;const n=document.createElement("div");n.setAttribute("class","about-page__rules"),this.elementsArray.forEach(e=>{n.appendChild(e.render())}),this.element=n,this.logoText="About",e()})})}}).add(r.SIGN_IN,new class extends u{build(){return m.addHandler("btnSignInSubmit",()=>this.submit()),new Promise(e=>{this.template="<Label {{name=login}} {{class=login-page_error}}>\n\t\t\t\t\t\t<Input {{name=login}} {{class=login-page__signInInput}} {{placeholder=Enter your login}} {{check=loginMin loginMax russian}}>\n\t\t\t\t\t\t<Label {{name=password}} {{class=login-page_error}}>\n                        <Input {{name=password}} {{class=login-page__signInInput}} {{placeholder=Enter your password}} {{type=password}} {{check=passwordMin passwordMax russian}}>\n                        <Button {{class=main-page__menu__button__do}} {{text=Sign in}} {{click=btnSignInSubmit}}>\n                        <Button {{class=main-page__button}} {{text=Back}} {{click=goMenu}}>",I.toHTML(this.template).then(t=>{this.elementsArray=t.slice(0,5);const n=document.createElement("form");this.elementsArray.forEach(e=>{n.appendChild(e.render())});const s=document.createElement("div");s.appendChild(n),s.appendChild(t[5].render()),s.setAttribute("class","signIn-page_menu"),this.element=s,e()})})}submit(){if(this.validator.isValid()){const e={};Object.keys(this.inputs).forEach(t=>{e[t]=this.inputs[t].render().value}),c.logIn(e).then(e=>{this.errorLabels.login.render().innerText=this.errorMessages[e]||"Internal error",this.errorLabels.login.show(),setTimeout(()=>this.errorLabels.login.hide(),3e3)})}}afterRender(){return new Promise(e=>{this.mainEvent=this.submit,this.inputs={login:this.elementsArray[1],password:this.elementsArray[3]},this.errorLabels={login:this.elementsArray[0],password:this.elementsArray[2]},Object.keys(this.errorLabels).forEach(e=>{this.errorLabels[e].hide()}),this.validator=new k(this.inputs,this.errorLabels),Object.keys(this.inputs).forEach(e=>{this.inputs[e].render().addEventListener("blur",()=>{this.validator.checkInput(e)})}),this.errorMessages={400:"Incorrect login or password"},e()})}}).add(r.SIGN_UP,new class extends u{build(){return m.addHandler("btnSignUpSubmit",()=>this.submit()),new Promise(e=>{this.template="<Label {{name=login}} {{class=login-page_error}}>\n\t\t\t\t\t\t<Input {{name=login}} {{class=login-page__signUpInput}} {{placeholder=Enter your login}} {{check=loginMin loginMax russian}}>\n\t\t\t\t\t\t<Label {{name=email}} {{class=login-page_error}}>\n\t\t\t\t\t    <Input {{name=email}} {{class=login-page__signUpInput}} {{placeholder=Enter your email}} {{check=email russian}}>\n\t\t\t\t\t    <Label {{name=password}} {{class=login-page_error}}>\n                        <Input {{name=password}} {{class=login-page__signUpInput}} {{placeholder=Enter your password}} {{type=password}} {{check=passwordMin passwordMax russian}}>\n                        <Label {{name=passwordConfirm}} {{class=login-page_error}}>\n                        <Input {{name=passwordConfirm}} {{class=login-page__signUpInput}} {{placeholder=Repeat your password}} {{type=password}} {{check=passwordsEquality russian}}>\n                        <Button {{class=main-page__menu__button__do}} {{text=Sign up}} {{click=btnSignUpSubmit}}>\n                        <Button {{class=main-page__menu__button}} {{text=Back}} {{click=goMenu}}>",I.toHTML(this.template).then(t=>{this.elementsArray=t.slice(0,9);const n=document.createElement("form");this.elementsArray.forEach(e=>{n.appendChild(e.render())});const s=document.createElement("div");s.appendChild(n),s.appendChild(t[9].render()),this.element=s,e()})})}submit(){if(this.validator.isValid()){const e={};Object.keys(this.inputs).forEach(t=>{e[t]=this.inputs[t].render().value}),c.register(e).then(e=>{this.errorLabels.login.render().innerText=this.errorMessages[e]||"Internal error",this.errorLabels.login.show(),setTimeout(()=>this.errorLabels.login.hide(),3e3)})}}afterRender(){return this.mainEvent=this.submit,new Promise(e=>{this.inputs={login:this.elementsArray[1],email:this.elementsArray[3],password:this.elementsArray[5],passwordConfirm:this.elementsArray[7]},this.errorLabels={login:this.elementsArray[0],email:this.elementsArray[2],password:this.elementsArray[4],passwordConfirm:this.elementsArray[6]},Object.keys(this.errorLabels).forEach(e=>{this.errorLabels[e].hide()}),this.validator=new M(this.inputs,this.errorLabels),Object.keys(this.inputs).forEach(e=>{this.inputs[e].render().addEventListener("blur",()=>{this.validator.checkInput(e)})}),this.errorMessages={400:"User with a such login already exists"},e()})}}).add(r.PROFILE,new class extends u{constructor(){super(),this._needAuth=!0}build(){return this.template="<Img {{src=./static/img/user-default.jpg}} {{class=user-page__img}}>\n                         <UserInfo>\n                         <Button {{text=Back}} {{class=main-page__menu__button}} {{click=goMenu}}>\n                         <Button {{text=LogOut}} {{class=main-page__menu__button}} {{click=logOut}}>",new Promise(e=>{I.toHTML(this.template).then(t=>{this.elementsArray=t;const n=document.createElement("div");n.setAttribute("class","profile-page__info"),this.elementsArray.forEach(e=>{n.appendChild(e.render())}),this.element=n,this.userBlock=this.elementsArray[1],this.logoText="Your profile",e()})})}afterRender(){return new Promise(e=>e(this.userBlock.afterRender()))}show(){return super.show()}}).add(r.HIGH_SCORE,new class extends u{build(){return m.addHandler("loadScoreRows",()=>this.updateScore()),new Promise(e=>{this.template="<ScoreTable>\n                         <Label {{class=score-loading}} {{text=loading...}}>\n                         <Block {{class=leaderboard-page__pagination}}>\n                         <Button {{text=Back}} {{class=main-page__button}} {{click=goMenu}}>",I.toHTML(this.template).then(t=>{this.elementsArray=t,this.scoreTable=this.elementsArray[0],this.loadingLabel=this.elementsArray[1],this.paginator=this.elementsArray[2],this.loadingLabel.hide();const n=document.createElement("div");n.setAttribute("class","highScore-page__list"),this.elementsArray.forEach(e=>{n.appendChild(e.render())}),this.element=n,this.logoText="Leaders",this.currentPage=1,this.paginate(this.currentPage),s.on("getPage",this.paginate.bind(this)),e()})})}initPaginator(){this.pagesArray=[],this.pagesArray.push(new L("<<"));for(let e=0;e<5;e++)this.pagesArray.push(new L(e+1));this.pagesArray.push(new L(">>")),this.pagesArray[1].render().setAttribute("class","active"),this.pagesArray.forEach(e=>{this.paginator.render().appendChild(e.render())})}paginate(e){this.pagesArray||this.initPaginator(),this.pageMap={"-1":this.currentPage-1,"+1":this.currentPage+1};const t=this.pageMap[e]||e;t>5||t<1||l.Get(`/user?page=${t}&page_size=5`).then(e=>e.json()).then(e=>{this.scoreTable.render().innerHTML="",e.forEach(e=>{this.scoreTable.render().innerHTML+=`<p>${e.login} ${e.score}</p>`}),this.pagesArray[this.currentPage].setUsual(),this.pagesArray[t].setActive(),this.currentPage=t})}afterRender(){return super.afterRender()}updateScore(){this.loadingLabel.show()}}).add(r.SINGLE_PLAYER,new class extends u{constructor(){super(),this._needAuth=!0,this.x=0,this.y=0,this.gameMode=!1,document.addEventListener("keydown",e=>{if(this.gameMode){const t=String.fromCharCode(e.keyCode||e.charCode);this.ctx.fillStyle="rgb(255, 255, 255",this.ctx.fillRect(this.x,this.y,30,30),this.ctx.fillStyle="rgb(0, 0, 200)","S"===t?this.y+=10:"W"===t?this.y-=10:"D"===t?this.x+=10:"A"===t&&(this.x-=10),this.ctx.fillRect(this.x,this.y,30,30)}})}build(){return new Promise(e=>{this.template="<GameBlock>",I.toHTML(this.template).then(t=>{this.elementsArray=t;const n=document.createElement("div");n.setAttribute("class","block-game_simple"),this.elementsArray.forEach(e=>{n.appendChild(e.render())}),this.element=n,e()})})}afterRender(){return new Promise(e=>{this.gameMode=!0,this.handleGameProcess(),e()})}hide(){super.hide(),this.gameMode=!1}handleGameProcess(){this.ctx=document.getElementsByClassName("game-block")[0].getContext("2d"),this.ctx.fillStyle="rgb(0, 0, 200)",this.ctx.fillRect(this.x,this.y,30,30)}}),i.start()})}]);
//# sourceMappingURL=bundle.js.map